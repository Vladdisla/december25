<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Онлайн расчет стоимости | GlassInterior</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Manrope', sans-serif; background-color: #F3F5F9; }

        /* Плавные переходы */
        .fade-enter {
            animation: fadeIn 0.4s ease-in-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Стили карточек выбора */
        .option-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #E5E7EB;
        }
        .option-card:hover {
            border-color: #93C5FD;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.1);
        }
        .option-card.active-choice {
            border-color: #3B82F6;
            background-color: #EFF6FF; /* Очень светло-синий фон */
            box-shadow: 0 0 0 2px #3B82F6;
        }
        
        /* Кнопка Далее */
        .btn-next {
            background-color: #818CF8; /* Мягкий индиго как на скрине */
            transition: 0.3s;
        }
        .btn-next:hover { background-color: #6366F1; }
        .btn-next:disabled { background-color: #C7D2FE; cursor: not-allowed; }

        /* Слайдер */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px; width: 20px;
            border-radius: 50%; background: #4F46E5;
            cursor: pointer; margin-top: -8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            background: #E0E7FF; border-radius: 2px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center relative overflow-hidden">

    <div class="text-center mb-8 z-10 px-4">
        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 mb-2">Онлайн расчет стоимости</h1>
        <p class="text-gray-400 text-sm md:text-base">Пройдите тест и получите смету за 15 минут</p>
    </div>

    <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-blue-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
    <div class="absolute top-1/3 right-1/4 w-96 h-96 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>

    <div class="w-full max-w-4xl bg-white rounded-[30px] shadow-2xl p-6 md:p-10 z-20 relative mx-4 transition-all duration-500" id="quiz-container" style="min-height: 500px;">
        
        <div class="flex flex-col md:flex-row justify-between items-end md:items-center mb-8 border-b border-gray-100 pb-6">
            <div>
                <h2 class="text-xl font-bold text-gray-800">Параметры заказа</h2>
                <p class="text-xs text-gray-400 mt-1 font-medium">Вопрос <span id="current-step">1</span> из <span id="total-steps">7</span></p>
            </div>
            
            <div class="w-full md:w-1/3 mt-4 md:mt-0">
                <div class="flex justify-between text-xs font-bold text-blue-600 mb-2">
                    <span>Точность</span>
                    <span id="progress-text">15%</span>
                </div>
                <div class="w-full bg-gray-100 h-2.5 rounded-full overflow-hidden">
                    <div class="bg-blue-600 h-full transition-all duration-700 ease-out rounded-full" id="progress-bar" style="width: 15%"></div>
                </div>
            </div>
        </div>

        <div id="step-content" class="fade-enter h-full flex flex-col justify-between">
            </div>

        <div class="flex justify-between items-center mt-auto pt-10">
            <button onclick="prevStep()" id="btn-prev" class="text-gray-400 hover:text-gray-600 font-semibold text-sm transition flex items-center px-4 py-2 rounded-lg hover:bg-gray-50 opacity-0 pointer-events-none">
                <i class="fas fa-arrow-left mr-2"></i> Назад
            </button>

            <button onclick="nextStep()" id="btn-next" class="btn-next text-white px-10 py-3.5 rounded-xl font-bold shadow-lg shadow-indigo-500/20 flex items-center text-sm tracking-wide">
                Далее <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>
    </div>

    <div id="thank-you-screen" class="hidden w-full max-w-lg bg-white rounded-[30px] shadow-2xl p-12 text-center z-20 mx-4 relative">
        <div class="w-24 h-24 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-6">
            <i class="fas fa-check text-4xl text-green-500"></i>
        </div>
        <h2 class="text-3xl font-bold text-gray-800 mb-4">Готово!</h2>
        <p class="text-gray-500 mb-8 leading-relaxed">
            Мы получили ваши параметры:<br>
            <span class="font-bold text-gray-800" id="result-summary">...</span>.<br>
            Расчет будет отправлен в течение 15 минут.
        </p>
        <button onclick="location.reload()" class="text-indigo-500 font-bold hover:text-indigo-700 transition">
            Рассчитать заново
        </button>
    </div>

    <script>
        const quizData = [
            // 1. ЛОКАЦИЯ (Иконки)
            {
                id: 'location',
                question: 'Куда планируется установка?',
                type: 'cards',
                options: [
                    { value: 'office', label: 'Офис / БЦ', icon: 'fa-building' },
                    { value: 'retail', label: 'ТЦ / Магазин', icon: 'fa-store' },
                    { value: 'home', label: 'Квартира / Дом', icon: 'fa-home' }
                ]
            },
            // 2. ЗАДАЧА (Зависит от локации)
            {
                id: 'type_office',
                condition: (a) => a.location === 'office' || a.location === 'retail',
                question: 'Основная задача?',
                type: 'cards',
                options: [
                    { value: 'meeting', label: 'Переговорная (Звук)', icon: 'fa-volume-mute' },
                    { value: 'zoning', label: 'Зонирование (Визуал)', icon: 'fa-eye' },
                    { value: 'entry', label: 'Входная группа', icon: 'fa-door-open' }
                ]
            },
            {
                id: 'type_home',
                condition: (a) => a.location === 'home',
                question: 'Тип конструкции?',
                type: 'cards',
                options: [
                    { value: 'shower', label: 'Душевая', icon: 'fa-shower' },
                    { value: 'partition', label: 'Перегородка', icon: 'fa-th-large' },
                    { value: 'railing', label: 'Ограждение', icon: 'fa-stairs' }
                ]
            },
            // 3. СТЕКЛО (С вашим SVG)
            {
                id: 'glass_type',
                question: 'Выберите тип стекла',
                type: 'cards',
                options: [
                    { value: 'clear', label: 'Прозрачное', icon: 'fa-window-maximize' },
                    { value: 'matte', label: 'Матовое', icon: 'fa-cloud' },
                    { 
                        value: 'tinted', 
                        label: 'Тонированное', 
                        // Ваш SVG для Графита
                        customSvg: `
                        <svg width="40" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" class="pointer-events-none mb-3">
                            <rect width="48" height="48" rx="12" fill="url(#paint0_linear)"/>
                            <rect x="23" y="10" width="2" height="28" fill="white" fill-opacity="0.6"/>
                            <defs>
                                <linearGradient id="paint0_linear" x1="0" y1="0" x2="48" y2="48" gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#BFDBFE"/>
                                    <stop offset="1" stop-color="#C084FC"/>
                                </linearGradient>
                            </defs>
                        </svg>` 
                    },
                    { value: 'smart', label: 'Smart Стекло', icon: 'fa-magic', color: 'text-purple-500' }
                ]
            },
            // 4. ФУРНИТУРА
            {
                id: 'hardware',
                question: 'Цвет фурнитуры',
                type: 'cards',
                options: [
                    { value: 'chrome', label: 'Хром / Сталь', icon: 'fa-circle', color: 'text-gray-300' },
                    { value: 'black', label: 'Черный (Loft)', icon: 'fa-circle', color: 'text-gray-800' },
                    { value: 'gold', label: 'Золото', icon: 'fa-circle', color: 'text-yellow-500' }
                ]
            },
            // 5. РАЗМЕРЫ
            {
                id: 'sizes',
                question: 'Примерные размеры (мм)',
                type: 'range',
                inputs: [
                    { id: 'width', label: 'Ширина', min: 500, max: 10000, step: 100, def: 2000 },
                    { id: 'height', label: 'Высота', min: 1000, max: 4000, step: 50, def: 2500 }
                ]
            },
            // 6. СРОКИ
            {
                id: 'timeline',
                question: 'Когда нужен монтаж?',
                type: 'cards',
                options: [
                    { value: 'asap', label: 'Срочно', icon: 'fa-bolt', color: 'text-yellow-500' },
                    { value: 'repair', label: 'Идет ремонт', icon: 'fa-tools' },
                    { value: 'planning', label: 'Планирую', icon: 'fa-calendar' }
                ]
            },
            // 7. КОНТАКТЫ (С Email)
            {
                id: 'contacts',
                question: 'Куда отправить расчет?',
                type: 'form',
                options: ['WhatsApp', 'Telegram', 'Email'] 
            }
        ];

        // --- ЛОГИКА ---
        let stepIndex = 0;
        let activeSteps = [];
        let answers = {};

        function init() {
            calcSteps();
            render();
        }

        function calcSteps() {
            activeSteps = quizData.filter(step => !step.condition || step.condition(answers));
        }

        function render() {
            const step = activeSteps[stepIndex];
            const container = document.getElementById('step-content');
            
            // Заголовок вопроса
            let html = `<h3 class="text-2xl md:text-3xl font-extrabold text-gray-800 mb-8">${step.question}</h3>`;

            // Рендер КАРТОЧЕК
            if (step.type === 'cards') {
                // Если опций 3 - ставим 3 колонки, если 4 - то 4 (на десктопе)
                const gridClass = step.options.length === 4 ? 'grid-cols-2 md:grid-cols-4' : 'grid-cols-1 md:grid-cols-3';
                
                html += `<div class="grid ${gridClass} gap-4 md:gap-6">`;
                step.options.forEach(opt => {
                    const isActive = answers[step.id] === opt.value ? 'active-choice' : '';
                    
                    let iconHtml;
                    if (opt.customSvg) {
                        iconHtml = opt.customSvg;
                    } else {
                        const colorClass = opt.color || 'text-blue-500'; // Синий по умолчанию
                        iconHtml = `<i class="fas ${opt.icon} text-4xl ${colorClass} mb-3 transition-colors"></i>`;
                    }
                    
                    html += `
                        <div class="option-card ${isActive} bg-white rounded-2xl p-8 cursor-pointer flex flex-col items-center justify-center text-center h-48 md:h-56"
                             onclick="handleSelect('${step.id}', '${opt.value}')">
                            ${iconHtml}
                            <span class="font-bold text-gray-700 text-sm md:text-base">${opt.label}</span>
                        </div>
                    `;
                });
                html += `</div>`;
            } 
            // Рендер ПОЛЗУНКОВ
            else if (step.type === 'range') {
                html += `<div class="space-y-8 max-w-xl mx-auto py-4">`;
                step.inputs.forEach(inp => {
                    const val = answers[inp.id] || inp.def;
                    if(!answers[inp.id]) answers[inp.id] = inp.def; // Default init
                    html += `
                        <div class="bg-gray-50 p-6 rounded-2xl border border-gray-100">
                            <div class="flex justify-between mb-4">
                                <label class="font-bold text-gray-700">${inp.label}</label>
                                <div class="bg-white px-3 py-1 rounded-lg border border-gray-200 font-mono text-blue-600 font-bold">${val} мм</div>
                            </div>
                            <input type="range" min="${inp.min}" max="${inp.max}" step="${inp.step}" value="${val}"
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                oninput="handleRange('${inp.id}', this.value)">
                        </div>`;
                });
                html += `</div>`;
            }
            // Рендер ФОРМЫ
            else if (step.type === 'form') {
                if(!answers.messenger) answers.messenger = 'WhatsApp';
                
                const isEmail = answers.messenger === 'Email';
                const inputType = isEmail ? 'email' : 'tel';
                const placeholder = isEmail ? 'example@mail.ru' : '+7 (999) 000-00-00';
                
                html += `<div class="max-w-md mx-auto space-y-6 pt-4">`;
                
                // Табы мессенджеров
                html += `<div class="flex p-1 bg-gray-100 rounded-xl">`;
                step.options.forEach(m => {
                    const activeClass = answers.messenger === m ? 'bg-white shadow-sm text-blue-600' : 'text-gray-500 hover:text-gray-700';
                    html += `<div onclick="handleInput('messenger', '${m}'); render();" 
                                  class="flex-1 text-center py-2.5 rounded-lg text-sm font-bold cursor-pointer transition-all ${activeClass}">${m}</div>`;
                });
                html += `</div>`;

                // Инпут
                html += `<div class="relative">
                            <input type="${inputType}" placeholder="${placeholder}" 
                                   class="w-full bg-gray-50 border-2 border-gray-100 rounded-xl px-5 py-4 focus:bg-white focus:border-blue-500 outline-none transition text-lg font-medium text-gray-800 placeholder-gray-400" 
                                   oninput="handleInput('phone', this.value)" 
                                   value="${answers.phone || ''}">
                         </div>`;
                
                // Подсказка Email
                html += `<div class="text-center text-xs text-gray-400">
                            Официальный ящик: <span class="text-gray-600 font-medium">info@steklo-interior.ru</span>
                         </div>`;
                
                html += `</div>`;
            }

            container.innerHTML = html;
            updateUI();
        }

        // --- HANDLERS ---

        function handleSelect(id, val) {
            answers[id] = val;
            if(id === 'location') calcSteps(); // Пересчет шагов при смене локации
            
            // Автопереход
            setTimeout(() => { nextStep(); }, 300);
            render(); // Обновляем визуально сразу
        }

        function handleRange(id, val) {
            answers[id] = val;
            const display = event.target.previousElementSibling.querySelector('div');
            if(display) display.innerText = val + ' мм';
        }

        function handleInput(key, val) {
            answers[key] = val;
            updateUI(); // Для активации кнопки
        }

        function nextStep() {
            if(stepIndex < activeSteps.length - 1) {
                stepIndex++;
                render();
            } else {
                finish();
            }
        }

        function prevStep() {
            if(stepIndex > 0) {
                stepIndex--;
                render();
            }
        }

        function updateUI() {
            const current = stepIndex + 1;
            const total = activeSteps.length;
            const percent = Math.round((current / total) * 100);

            // Обновляем Header
            document.getElementById('current-step').innerText = current;
            document.getElementById('total-steps').innerText = total;
            document.getElementById('progress-text').innerText = percent + '%';
            document.getElementById('progress-bar').style.width = percent + '%';

            // Кнопки
            const prev = document.getElementById('btn-prev');
            const next = document.getElementById('btn-next');
            const step = activeSteps[stepIndex];

            // Логика кнопки Назад
            if(stepIndex === 0) {
                prev.style.opacity = '0';
                prev.style.pointerEvents = 'none';
            } else {
                prev.style.opacity = '1';
                prev.style.pointerEvents = 'auto';
            }

            // Валидация кнопки Далее
            let isValid = true;
            if(step.type === 'cards' && !answers[step.id]) isValid = false;
            if(step.type === 'form') {
                if(!answers.phone || answers.phone.length < 5) isValid = false;
            }

            next.disabled = !isValid;
            next.style.opacity = isValid ? '1' : '0.6';
            
            if(stepIndex === total - 1) {
                next.innerHTML = 'Получить расчет <i class="fas fa-paper-plane ml-2"></i>';
            } else {
                next.innerHTML = 'Далее <i class="fas fa-arrow-right ml-2"></i>';
            }
        }

        function finish() {
            console.log("SENDING DATA:", answers);
            
            let type = 'Конструкция';
            if (answers.glass_type === 'clear') type = 'Прозрачное стекло';
            if (answers.glass_type === 'tinted') type = 'Тонированное стекло';
            if (answers.glass_type === 'smart') type = 'Smart стекло';

            document.getElementById('result-summary').innerText = type;

            // Скрываем квиз, показываем Спасибо
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('thank-you-screen').classList.remove('hidden');
        }

        // Запуск
        init();
    </script>
</body>
</html>